<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Running a Java Application as a Linux Service &#8212; LaunchCode: GIS DevOps  documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Walkthrough: Unit Tests" href="../unit-tests/index.html" />
    <link rel="prev" title="Todo Tasks Deployment Single EC2" href="../todo-tasks-single-ec2-deployment/index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
          GIS DevOps</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="/installations/index.html">Installations</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ol>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day1/index.html">Week 1 - Day 1: Welcome, Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day2/index.html">Week 1 - Day 2: Terminal, Shell, Git</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day3/index.html">Week 1 - Day 3: Shell, Git, SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day4/index.html">Week 1 - Day 4: SQL, HTTP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week01/day5/index.html">Week 1 - Day 5: HTTP, Docker</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day1/index.html">Week 2 - Day 1: HTML, CSS, Browser DevTools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day2/index.html">Week 2 - Day 2: HTML/CSS Template, JavaScript Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day3/index.html">Week 2 - Day 3: Programming Fundamentals, JavaScript, DOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day4/index.html">Week 2 - Day 4: JS, DOM, Promises, AJAX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week02/day5/index.html">Week 2 - Day 5: Promises, AJAX, HTTP</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day1/index.html">Week 3 - Day 1: Java, OOP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day2/index.html">Week 3 - Day 2: Spring Boot, Controllers, Routes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day3/index.html">Week 3 - Day 3: Models, ORM (Hibernate)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day4/index.html">Week 3 - Day 4: Persistence, ORM Relationships</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week03/day5/index.html">Week 3 - Day 5: Review</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day1/index.html">Week 4 - Day 1: Git, GitLab, IntelliJ, Refactoring, Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day2/index.html">Week 4 - Day 2: Security, Test-driven development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day3/index.html">Week 4 - Day 3: Integration testing, dependency injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day4/index.html">Week 4 - Day 4: Postgres, Spring Data, JPA, Hibernate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week04/day5/index.html">Week 4 - Day 5: AJAX, Open Layers</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week05/project/index.html">Week 5 - Project Week: Zika Mission Control</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day1/index.html">Week 6 - Day 1: RESTful web services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day2/index.html">Week 6 - Day 2: Swagger REST framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day3/index.html">Week 6 - Day 3: Intro to Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day4/index.html">Week 6 - Day 4: More Elasticsearch, Integrating ES with Spring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week06/day5/index.html">Week 6 - Day 5: ES2015, ESLint, OpenLayers</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week07/project/index.html">Week 7 - Project Week: Zika Mission Control Part 2</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day1/index.html">Week 8 - Day 1: Intro to DevOps/AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day2/index.html">Week 8 - Day 2: More with AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day3/index.html">Week 8 - Day 3: 12 Factor Apps and Auto Scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day4/index.html">Week 8 - Day 4: Gradle, Continuous Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week08/day5/index.html">Week 8 - Day 5: Sonarqube</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week09/project/index.html">Week 9 - Project Week: Zika Mission Control Part 3</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week11/project/index.html">Week 11 - Project Week: Zika Mission Control Part 4</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../week12/day3/index.html">Week 12 - Day 3: Intro to Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week12/day4/index.html">Week 12 - Day 4: OAuth 2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../week12/day5/index.html">Week 12 - Day 5: Certificates</a></li>
</ol>
<ol class="current">
<li class="toctree-l1"><a class="reference internal" href="../aws-intro/index.html">Walkthrough: Intro to AWS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws-rds-walkthrough/index.html">Walkthrough: RDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client-certificates/index.html">Client Certificates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client-deployment-s3/index.html">Deploy Zika Client to S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../curl/index.html">Walkthrough: Intro to Curl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker/index.html">Walkthrough: Intro to Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elasticsearch-spring/index.html">Walkthrough: Elasticsearch in Spring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elasticsearch/index.html">Walkthrough: Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elasticsearch2/index.html">Walkthrough: Elasticsearch Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eslint-airwaze/index.html">Walkthrough: ESLint Airwaze</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gitLab/index.html">Walkthrough: Git and Gitlab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gradle/index.html">Walkthrough: Gradle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hashing-salting/index.html">Walkthrough: Hashing and Salting Passwords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jenkins/index.html">Walkthrough: CI/CD With Jenkins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../launchcart-rest/index.html">Walkthrough: LaunchCart REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nginx-proxy-spring/index.html">NGINX as a Proxy to Spring Apache Tomcat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../oauth2/index.html">Visual OAuth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openlayers/index.html">Walkthrough: OpenLayers and jQuery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../postgress/index.html">Walkthrough: PostgreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sonarqube/index.html">Walkthrough: Sonarqube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spring-data-jpa-hibernate/index.html">Walkthrough: Cars Demo - Spring Data, JPA, Hibernate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spring-integration-testing/index.html">Walkthrough: Spring Integration Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spring-pet-api-postgres-integration/index.html">Spring Postgres Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../springfox-swagger/index.html">Walkthrough: SwaggerUI via SpringFox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../swagger/index.html">Walkthrough: SwaggerUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tdd/index.html">Walkthrough: TDD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../todo-tasks-single-ec2-deployment/index.html">Todo Tasks Deployment Single EC2</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running a Java Application as a Linux Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unit-tests/index.html">Walkthrough: Unit Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading-spring-boot/index.html">Walkthrough: Upgrading to Spring Boot 2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch-todo-tasks-deployment/index.html">Watch a Todo Tasks Deployment</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../studios/airwaze/index.html">Studio: Airwaze</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/aws-EC2-basics/index.html">Studio: AWS Devops Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/aws-auto-scaling/index.html">Scaling horizontally AutoScaling Group</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/aws-rds-vpc/index.html">Studio: AWS RDS VPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/curl/index.html">Curl Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/elasticsearch1/index.html">Elasticsearch Query Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/elasticsearch2/index.html">Elasticsearch Queries Studio 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/junit/index.html">Studio: JUnit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/launchcart-rest/index.html">Studio: LaunchCart REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/launchcart1/index.html">Studio: LaunchCart Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/launchcart2/index.html">Studio: LaunchCart Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/openlayers-es2015/index.html">Studio: OpenLayers ES2015 Workshop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/swagger/index.html">Studio: Springfox and Swagger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../studios/tdd/index.html">Studio: Test-Driven Development</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../project-requirements/deploy-mapnotes-api-single-ec2/index.html">Project: Deploy Map Notes to a Single EC2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project-requirements/mapnotes-api/index.html">Project: Map Notes API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project-requirements/mapnotes-pipeline/index.html">Project: Mapnotes API Jenkins Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project-requirements/mapnotes-rds/index.html">Project: Map Notes Backed by AWS RDS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project-requirements/zika-client-rest/index.html">Project: Zika Client REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../project-requirements/zika-client/index.html">Project: Zika Client</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../installations/00-prep-week/index.html">Installation: Essential Tooling &amp; Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/01-docker/index.html">Installation: Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/02-docker-psql/index.html">Installation: Docker PSQL Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/03-docker-postgis/index.html">Installation: Docker PostGIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/04-docker-elasticsearch/index.html">Installation: Docker Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/05-docker-kibana/index.html">Installation: Docker Kibana</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installations/06-docker-jenkins/index.html">Installation: Docker Jenkins</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/00-intellij/index.html">Configuration: IntelliJ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/01-runtime-configurations/index.html">Configuration: IntelliJ - Runtime Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/02-environment-variables-intellij/index.html">Configuration: Environment Variables - IntelliJ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/04-spring-elasticsearch/index.html">Configuration: Spring &amp; Elasticsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/05-spring-postgres/index.html">Configuration: Spring &amp; Postgres</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configurations/06-vscode-eslint/index.html">Configuration: Visual Studio Code - ESLint</a></li>
</ol>
<ol>
<li class="toctree-l1"><a class="reference internal" href="../../notes/docker/index.html">Docker</a></li>
</ol>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Running a Java Application as a Linux Service</a><ul>
<li><a class="reference internal" href="#systemd">SystemD</a></li>
<li><a class="reference internal" href="#define-service-with-a-unit-file">Define Service with a Unit File</a><ul>
<li><a class="reference internal" href="#service-environment-file">Service Environment File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enabling-and-starting-our-service">Enabling and Starting our Service</a><ul>
<li><a class="reference internal" href="#enable-service">Enable Service</a></li>
<li><a class="reference internal" href="#start-service">Start Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting-our-service">Troubleshooting our Service</a></li>
<li><a class="reference internal" href="#service-best-practices">Service Best Practices</a><ul>
<li><a class="reference internal" href="#move-executable">Move Executable</a><ul>
<li><a class="reference internal" href="#create-executable-directory">Create Executable Directory</a></li>
<li><a class="reference internal" href="#id1">Move Executable</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service-owner">Service Owner</a><ul>
<li><a class="reference internal" href="#create-user">Create User</a></li>
<li><a class="reference internal" href="#update-file-system-permissions">Update File System Permissions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#update-unit-file">Update Unit File</a><ul>
<li><a class="reference internal" href="#reload-service">Reload Service</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#review">Review</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="running-a-java-application-as-a-linux-service">
<span id="unit-files"></span><h1>Running a Java Application as a Linux Service<a class="headerlink" href="#running-a-java-application-as-a-linux-service" title="Permalink to this headline">¶</a></h1>
<p>This walkthrough assumes you have deployed an API built with Java/Spring to a Virtual Machine.</p>
<p>If you need a refresher check out the <a class="reference internal" href="../todo-tasks-single-ec2-deployment/index.html#todo-tasks-deployment-single-ec2"><span class="std std-ref">Todo Tasks Deployment Single EC2</span></a> walkthrough.</p>
<p>That walkthrough ended with us running the application by manually issuing a bash command: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">java</span> <span class="pre">-jar</span> <span class="pre">todo-app.jar</span> <span class="pre">--DB_HOST=localhost</span> <span class="pre">--DB_PORT=5444</span> <span class="pre">--DB_NAME=todo</span> <span class="pre">--DB_USER=todo_user</span> <span class="pre">--DB_PASS=todopass</span> <span class="pre">--APP_PORT=80</span></code>.</p>
<p>While this worked for us in this educational environment, it is not a reliable solution for running our application. In the case of the server crashing, the EC2 instance going down, or experiencing a power outage the application would need to be manually started with the command used above.</p>
<p>There is an elegant solution for this in Linux. We can configure and run this Java application as a Linux SystemD service.</p>
<div class="section" id="systemd">
<h2>SystemD<a class="headerlink" href="#systemd" title="Permalink to this headline">¶</a></h2>
<p>SystemD is initialization software on most Linux distributions.</p>
<p>It gives us, the developers, a way of defining how an application can be run and managed by the Linux Operating System. When an application is ran, and managed by SystemD it is referred to as a SystemD <code class="docutils literal notranslate"><span class="pre">service</span></code>.</p>
<p>As the developers we can define whatever services we want. It is essentially instructions attached to an executable or an application.</p>
<p>To define a new service we will create a <code class="docutils literal notranslate"><span class="pre">unit</span></code> file that defines the executable and additional instructions.</p>
</div>
<div class="section" id="define-service-with-a-unit-file">
<h2>Define Service with a Unit File<a class="headerlink" href="#define-service-with-a-unit-file" title="Permalink to this headline">¶</a></h2>
<p>As a best practice we will be storing all of our Unit files in one place on our linux machines: <code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/</span></code>.</p>
<p>As an additional best practice we will name the unit file after the service we are creating. In this case the service is our Todo App. So we will create a new file named: <code class="docutils literal notranslate"><span class="pre">todo-app.service</span></code>.</p>
<p>Create the file and add the following code:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Unit File <code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/todo-app.service</span></code></span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Todo Tasks API
<span class="nv">After</span><span class="o">=</span>syslog.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>simple
<span class="nv">User</span><span class="o">=</span>ubuntu
<span class="nv">EnvironmentFile</span><span class="o">=</span>/etc/opt/todo-app/todo-app.config
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/java -jar /home/ubuntu/todo-app.jar <span class="nv">SuccessExitStatus</span><span class="o">=</span><span class="m">143</span>
<span class="nv">Restart</span><span class="o">=</span>always

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
</div>
</div>
<p>Let’s break down the configuration of this unit file:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Commented Unit File</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unit Section</span>
<span class="o">[</span>Unit<span class="o">]</span>
<span class="c1"># Human Readable Description of the Service</span>
<span class="nv">Description</span><span class="o">=</span>Todo Tasks API
<span class="c1"># After=list of units that must be started before this unit works</span>
<span class="nv">After</span><span class="o">=</span>syslog.target

<span class="c1"># Service Section</span>
<span class="o">[</span>Service<span class="o">]</span>
<span class="c1"># simple is the default value of Type, it is commonly left off</span>
<span class="nv">Type</span><span class="o">=</span>simple
<span class="c1"># User= sets the user, login shell, and home directory associated with this unit</span>
<span class="nv">User</span><span class="o">=</span>ubuntu
<span class="c1"># EnvironmentFile= points to the environment variables needed by the executable in this unit file</span>
<span class="nv">EnvironmentFile</span><span class="o">=</span>/home/ubuntu/todo-app.config
<span class="c1"># ExecStart= the exact command, or application to be run when this unit starts</span>
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/java -jar /home/ubuntu/todo-app.jar <span class="nv">SuccessExitStatus</span><span class="o">=</span><span class="m">143</span>
<span class="c1"># Restart= if the unit should restart after failing</span>
<span class="nv">Restart</span><span class="o">=</span>always

<span class="c1"># Install Section</span>
<span class="o">[</span>Install<span class="o">]</span>
<span class="c1"># WantedBy=multi-user.target is the command neccessary so this systemd unit can be enabled (which is what allows it to automatically start when the server boots up)</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
</div>
</div>
<p>We can now start our application with <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">todo-app.service</span></code>!</p>
<div class="section" id="service-environment-file">
<h3>Service Environment File<a class="headerlink" href="#service-environment-file" title="Permalink to this headline">¶</a></h3>
<p>Before we get to enabling and starting our new service we need to define the environment variables that are needed by our <code class="docutils literal notranslate"><span class="pre">todo-app.service</span></code>.</p>
<p>As a best practice we will be storing the environment variables for this service in: <code class="docutils literal notranslate"><span class="pre">/etc/opt/todo-app/todo-app.config</span></code>.</p>
<p>We will need to create the <code class="docutils literal notranslate"><span class="pre">todo-app/</span></code> directory inside of the <code class="docutils literal notranslate"><span class="pre">/etc/opt/</span></code> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mkdir /etc/opt/todo-app
</pre></div>
</div>
<p>We will then need to create and edit the environment variables with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo vim /etc/opt/todo-app/todo-app.config
</pre></div>
</div>
<p>Within vim change into insert mode by hitting <code class="docutils literal notranslate"><span class="pre">i</span></code> and paste in our environment variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">DB_HOST</span><span class="o">=</span>localhost
<span class="nv">DB_PORT</span><span class="o">=</span><span class="m">5444</span>
<span class="nv">DB_NAME</span><span class="o">=</span>todo
<span class="nv">DB_USER</span><span class="o">=</span>todo_user
<span class="nv">DB_PASS</span><span class="o">=</span>todopass
<span class="nv">APP_PORT</span><span class="o">=</span><span class="m">8080</span>
</pre></div>
</div>
<p>After pasting in these environment variables save and quit the file by hitting <code class="docutils literal notranslate"><span class="pre">esc</span></code> in vim and then entering <code class="docutils literal notranslate"><span class="pre">:wq</span></code> and hitting <code class="docutils literal notranslate"><span class="pre">enter</span></code>.</p>
<p>This will be the environment variables that are passed to the <code class="docutils literal notranslate"><span class="pre">ExecStart</span></code> directive in our Unit File. Note that these environment variables match up with the <code class="docutils literal notranslate"><span class="pre">application.properties</span></code> file of our Todo Tasks API. We are at runtime injecting a series of environment variables that are unique to this application environment.</p>
<p>As we progress through multiple deployments we will change some of these in the environment file to reflect the location and port of our database.</p>
</div>
</div>
<div class="section" id="enabling-and-starting-our-service">
<h2>Enabling and Starting our Service<a class="headerlink" href="#enabling-and-starting-our-service" title="Permalink to this headline">¶</a></h2>
<p>Now that we have defined our service with the unit file, and have created it’s necessary config file we can enable and start our service.</p>
<div class="section" id="enable-service">
<h3>Enable Service<a class="headerlink" href="#enable-service" title="Permalink to this headline">¶</a></h3>
<p>From the terminal of the EC2 enable the service to be managed by Linux:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo systemctl <span class="nb">enable</span> todo-app.service
</pre></div>
</div>
<p>Enabling the service is what tells our EC2 instance to automatically start this service when the machine first boots up. This will ensure that if the server restarts for any reason it will automatically restart our API!</p>
</div>
<div class="section" id="start-service">
<h3>Start Service<a class="headerlink" href="#start-service" title="Permalink to this headline">¶</a></h3>
<p>Although we enabled our service above, it will only start if the EC2 reboots. Instead of doing that, let’s simply start the service ourselves:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo systemctl start todo-app.service
</pre></div>
</div>
<p>And our service should attempt to start and is being managed by SystemD.</p>
</div>
</div>
<div class="section" id="troubleshooting-our-service">
<h2>Troubleshooting our Service<a class="headerlink" href="#troubleshooting-our-service" title="Permalink to this headline">¶</a></h2>
<p>The first few times you are defining a new service you will undoubtedly make mistakes, or in some cases the application may encounter a bug and print out information to the Tomcat logs.</p>
<p>We can view these logs by accessing the journal of this service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>journalctl -fu todo-app.service
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">journalctl</span></code> options:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-u</span></code>: the unit file we are accessing</li>
<li><code class="docutils literal notranslate"><span class="pre">-f</span></code>: print out the last 10 lines of the journal, update as new logs come in</li>
</ul>
<p>Reading these logs are invaluable for determining why a service cannot start. Common issues with Java Spring APIs:</p>
<ul class="simple">
<li>incorrect port</li>
<li>incorrect DB information</li>
<li>no environment variables</li>
</ul>
</div>
<div class="section" id="service-best-practices">
<h2>Service Best Practices<a class="headerlink" href="#service-best-practices" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>unit files live in: <code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/</span></code></li>
<li>config files live in: <code class="docutils literal notranslate"><span class="pre">/etc/opt/&lt;app-name&gt;/&lt;app-name&gt;/config</span></code></li>
<li>executables of services live in: <code class="docutils literal notranslate"><span class="pre">/opt/&lt;app-name&gt;/&lt;app-name-artifacts&gt;</span></code></li>
<li>service should be owned by non root singular user</li>
<li>service should only be accessible by non root singular user</li>
</ul>
<p>We are already following the first two best practices. However, we need to make some changes in order to achieve the remaining three best practices.</p>
<div class="section" id="move-executable">
<h3>Move Executable<a class="headerlink" href="#move-executable" title="Permalink to this headline">¶</a></h3>
<div class="section" id="create-executable-directory">
<h4>Create Executable Directory<a class="headerlink" href="#create-executable-directory" title="Permalink to this headline">¶</a></h4>
<p>We will need to create a new directory and move our JAR file into this new appropriate directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mkdir /opt/todo-app
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h4>Move Executable<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Now we need to move our JAR file into this location:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo mv /home/ubuntu/todo-app.jar /opt/todo-app
</pre></div>
</div>
<div class="admonition-note admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>note</p>
<p class="last">Now would be a good time to update our Service unit file, but we are about to make another change that will facilitate even more changes to the unit file, so let’s make those changes first and update our unit file in one pass.</p>
</div>
</div>
</div>
<div class="section" id="service-owner">
<h3>Service Owner<a class="headerlink" href="#service-owner" title="Permalink to this headline">¶</a></h3>
<p>One service should be owned by a non root user.</p>
<div class="section" id="create-user">
<h4>Create User<a class="headerlink" href="#create-user" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>useradd -M todo
</pre></div>
</div>
</div>
<div class="section" id="update-file-system-permissions">
<h4>Update File System Permissions<a class="headerlink" href="#update-file-system-permissions" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chown -R todo:todo /opt/todo-app /etc/opt/todo-app
</pre></div>
</div>
</div>
</div>
<div class="section" id="update-unit-file">
<h3>Update Unit File<a class="headerlink" href="#update-unit-file" title="Permalink to this headline">¶</a></h3>
<p>We need to reflect the changes made to the user, and the new JAR location in our unit file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Todo Tasks API
<span class="nv">After</span><span class="o">=</span>syslog.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>simple
<span class="nv">User</span><span class="o">=</span>todo <span class="c1"># this line changes to reflect the new todo user</span>
<span class="nv">EnvironmentFile</span><span class="o">=</span>/etc/opt/todo-app/todo-app.config
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/java -jar /opt/todo-app/todo-app.jar <span class="nv">SuccessExitStatus</span><span class="o">=</span><span class="m">143</span> <span class="c1"># this line changes to reflect the new location of the JAR file</span>
<span class="nv">Restart</span><span class="o">=</span>always

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
</div>
<div class="section" id="reload-service">
<h4>Reload Service<a class="headerlink" href="#reload-service" title="Permalink to this headline">¶</a></h4>
<p>Since our Service unit file has been changed we need to do a few steps to update it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo systemctl stop todo-app.service
sudo systemctl disable todo-app.service
sudo systemctl daemon-reload
sudo systemctl <span class="nb">enable</span> todo-app.service
sudo systemctl start todo-app.service
</pre></div>
</div>
<p>Now that we have updated our Service unit file to follow the best practices check that the application started up correctly by viewing it’s <code class="docutils literal notranslate"><span class="pre">journalctl</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="review">
<h2>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a></h2>
<p>This walkthrough converted our Todo Tasks API into a SystemD service.</p>
<p>The service is now manageable by Linux through the use of <code class="docutils literal notranslate"><span class="pre">systemctl</span></code>. In addition, the service is configured to start automatically on server startup, and to attempt to restart if the application crashes for any reason.</p>
<p>You may have noticed that we changed the port of this application to <code class="docutils literal notranslate"><span class="pre">8080</span></code> from what we used in the previous walkthrough using <code class="docutils literal notranslate"><span class="pre">80</span></code>. You may have a Security Group that is configured to allow traffic on port 80, but not port 8080.</p>
<p>You could update this yourself, or hang tight for the next walkthrough where we will see how to use <a class="reference internal" href="../nginx-proxy-spring/index.html#nginx-proxy-spring"><span class="std std-ref">NGINX as a Proxy to Spring Apache Tomcat</span></a> between port 80, and our running application on port 8080.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>